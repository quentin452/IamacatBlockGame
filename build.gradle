apply plugin: 'java'
apply plugin: 'application'

repositories {
    mavenLocal()
    mavenCentral()
    jcenter()
    maven { url "https://oss.sonatype.org/content/repositories/snapshots/" }
    maven { url "https://oss.sonatype.org/content/repositories/releases/" }
    maven { url "https://jitpack.io" }
    maven { url "https://nifty-gui.sourceforge.net/nifty-maven-repo" }
}
compileJava {
    sourceCompatibility = '17'
    targetCompatibility = '17'
}

dependencies {
    implementation files("src/main/resources/native/${getNativeFolder()}")
    // LWJGL 3.3.1
    implementation 'org.lwjgl:lwjgl:3.3.1'
    implementation 'org.lwjgl:lwjgl-glfw:3.3.1'
    implementation 'org.lwjgl:lwjgl-opengl:3.3.1'
    implementation 'org.lwjgl:lwjgl-assimp:3.3.1'
    implementation 'org.lwjgl:lwjgl-openal:3.3.1'
    implementation 'org.lwjgl:lwjgl-stb:3.3.1'
}

jar {
    duplicatesStrategy = 'exclude'
    manifest {
        attributes 'Main-Class': 'fr.iamacat.iamacatblockgame.Main',
                'JVM-Args': '-Xmx4096m -Xms512m -XX:+UseG1GC -Dsun.awt.noerasebackground=true -Djava.library.path=native'
    }
    from {
        configurations.runtimeClasspath.collect { it.isDirectory() ? it : zipTree(it) }
    }
}

application {
    mainClassName = 'fr.iamacat.iamacatblockgame.Main'
}

def getNativeFolder() {
    String osName = System.getProperty("os.name").toLowerCase()

    if (osName.contains("win")) {
        return "windows"
    } else if (osName.contains("mac")) {
        return "macosx"
    } else if (osName.contains("linux")) {
        return "linux"
    } else {
        throw new UnsupportedOperationException("Unsupported operating system: " + osName)
    }
}
